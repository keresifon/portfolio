

String buildConfigJSONFile = 'build-configs.json'
LinkedHashMap buildConfigs = [:]


String registry = 'keresifon/jenkins-test'
String registryCredential = 'keresifon'
String dockerImage = null
String linuxAgent = 'node'
String credentialsId = 'Github'

node (linuxAgent){
    
   

    stage('Cloning our Git') { 

          checkout scm
          buildConfigs = readJSON file:buildConfigJSONFile, returnPojo: true
          
        } 

    stage('Building our image') { 

        
                  dockerImage = docker.build registry + ":${buildConfigs.version}"
                
                
 
        }

        stage('Deploy our image') { 

withDockerRegistry(credentialsId: 'Github') {
    // dockerImage.push() 
     docker.push registry + ":${buildConfigs.version}" 

}

                        


        } 

        stage('Cleaning up') { 

            

                sh "docker rmi $registry:${buildConfigs.version}" 

        

        } 

}