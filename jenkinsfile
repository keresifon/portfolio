

String buildConfigJSONFile = 'build-configs.json'
LinkedHashMap buildConfigs = [:]


String registry = 'keresifon/jenkins-test'
String registryCredential = 'keresifon'
String dockerImage = ''
String linuxAgent = 'node'
String credentialsId = 'Github'

node (linuxAgent){
    
   

    stage('Cloning our Git') { 

          checkout scm
          buildConfigs = readJSON file:buildConfigJSONFile, returnPojo: true
          
        } 

    stage('Building our image') { 

        
                  dockerImage = docker.build registry + ":${buildConfigs.version}"
                  

 
        }

        stage('Deploy our image') { 

withDockerRegistry(credentialsId: 'Github') {
    // dockerImage.push() 
    sh "docker push docker.build registry + ':${buildConfigs.version}'"
}

                        


        } 

        stage('Cleaning up') { 

            

                sh "docker rmi $registry:latest" 

        

        } 

}